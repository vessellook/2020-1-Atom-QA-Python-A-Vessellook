# Анализатор логов NGINX

## Bash скрипты

Все bash скрипты лежат в папке scripts/

### count.sh (задания 1-2)
<pre>
Скрипт count.sh выполняет подсчёт логов
Опции:
  -p PATH
      Задаёт путь к логам. Если директория, то логи собираются из всех файлов. Если путь не задан, то ожидает ввод со стандартного потока
  -c CODE
       Для всех заданий, кроме первого, задаёт код ответа, по которому фильтруются записи логов. Можно выбрать класс ошибок, например, проверять записи только с клиентскими ошибками, если передать -c 4. Для задания 5 по умолчанию опция -c 5, для задания 4 по умолчанию опция -c 4. Для остальных заданий опции
  -m METHOD
       Если задана опция -t 2, то задаёт метод, по которому фильтруются записи логов. По умолчанию GET
  -h
       Справка

Примеры:
scripts/count.sh < logs/access.log

scripts/count.sh -p logs/ -m POST

scripts/count.sh < logs/big.access.log -c 4
</pre>
### top.sh (задания 3-5)
<pre>
Скрипт top.sh выполняет фильтрацию и сортировку логов
Опции:
  -p PATH
      Задаёт путь к логам. Если директория, то логи собираются из всех файлов. Если путь не задан, то ожидает ввод со стандартного потока
  -c CODE
       Задаёт код ответа, по которому фильтруются записи логов. Можно выбрать класс ошибок, например, проверять записи только с клиентскими ошибками, если передать -c 4
  -m METHOD
       Задаёт HTTP метод, по которому фильтруются записи логов
  -h
       Справка
  -o OUTPUT
       Задаёт файл для вывода. Если файл не задан, то выводит результат в стандартный поток вывода
  -s SORT_BY
       Задаёт сортировку. Возможные значения
         SIZE     - сортирует по убыванию размера тела ответа
         LOCATION - сортирует по частоте того или иного пути в HTTP запросе
  -l LIMIT
       Если задана опция -t 3, -t 4 или -t 5, то задаёт максимальное количество выводимых логов
  -f FILLER
       Если задана опция -t 3, -t 4 или -t 5, то задаёт разделитель между полями в выводимых записях. По умолчанию пробел
       В начале и конце строк разделитель не ставится, строки разделяются символом "\n"
Примеры:
scripts/top.sh -c 4 -s LOCATION < logs/big.access.log

scripts/top.sh -c 5 -s SIZE -p logs/access.log

scripts/top.sh -m POST -c 404 -o output.txt < logs/
</pre>

## Python скрипты

Все Python скрипты лежат в папке code/

### count.py (задания 1-2)
<pre>
Скрипт count.py выполняет подсчёт логов
Опции:
  --code CODE, -c CODE
       Для всех заданий, кроме первого, задаёт код ответа, по которому фильтруются записи логов. Можно выбрать класс ошибок, например, проверять записи только с клиентскими ошибками, если передать -c 4. Для задания 5 по умолчанию опция -c 5, для задания 4 по умолчанию опция -c 4. Для остальных заданий опции
  --method METHOD, -m METHOD
       Если задана опция -t 2, то задаёт метод, по которому фильтруются записи логов. По умолчанию GET
  --help, -h
       Справка
  Все остальные параметры считаются путями к логам

Примеры:
python code/count.py logs/access.log

python code/count.py logs/access.log -m POST

python code/count.py logs/big.access.log -c 4
</pre>


### top.py (задания 3-5)
<pre>
Скрипт top.py выполняет фильтрацию и сортировку логов
Опции:
  --code CODE, -c CODE
       Для всех заданий, кроме первого, задаёт код ответа, по которому фильтруются записи логов. Можно выбрать класс ошибок, например, проверять записи только с клиентскими ошибками, если передать -c 4. Для задания 5 по умолчанию опция -c 5, для задания 4 по умолчанию опция -c 4. Для остальных заданий опции
  --method METHOD, -m METHOD
       Если задана опция -t 2, то задаёт метод, по которому фильтруются записи логов. По умолчанию GET
  --help, -h
       Справка
  --output OUTPUT, -o OUTPUT
       Задаёт файл для вывода. Если файл не задан, то выводит результат в стандартный поток вывода
  --sort-by SORT_BY, -s SORT_BY
       Задаёт сортировку. Возможные значения
         SIZE     - сортирует по убыванию размера тела ответа
         LOCATION - сортирует по частоте того или иного пути в HTTP запросе
  --limit LIMIT, -l LIMIT
       Если задана опция -t 3, -t 4 или -t 5, то задаёт максимальное количество выводимых логов
  --filler FILLER, -f FILLER
       Если задана опция -t 3, -t 4 или -t 5, то задаёт разделитель между полями в выводимых записях. По умолчанию пробел
       В начале и конце строк разделитель не ставится, строки разделяются символом "\n"
  Все остальные параметры считаются путями к логам

Примеры:
python code/top.py logs/access.log

python code/top.py logs/access.log --method POST --json

python code/count.py logs/big.access.log --code 4
</pre>

### Json формат

Пример json (*python code/top.py logs/access.log -c 4*):
<pre>
[
    {
        "ip": "127.0.0.1",
        "location": "/",
        "method": "POST",
        "response_size": 157,
        "status_code": 405
    },
    {
        "ip": "127.0.0.1",
        "location": "/",
        "method": "DELETE",
        "response_size": 157,
        "status_code": 405
    },
    {
        "ip": "127.0.0.1",
        "location": "/some_location",
        "method": "GET",
        "response_size": 153,
        "status_code": 404
    }
]
</pre>